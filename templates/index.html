{#  #}
{# 主页面页面 栈、队列、排序、链表、汉诺塔 #}
{#  #}

{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>hello world</title>
  <script src="{% static 'js/jquery-3.5.1.min.js' %}"></script>
  <script src="{% static 'js/jquery.swap.js' %}"></script>
  <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
</head>
<body>
  <div class="container">
    <h1 class="mt-2">1.排序算法动态演示</h1>

    <button onclick="zong()" class="btn btn-outline-success mt-2">开始排序</button>
    <button onclick="restart()" class="btn btn-outline-success mt-2">生成新的随机数/重新开始</button>

    <h3 class="mt-3">冒泡排序</h3>
    <button id="m1" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="m2" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">14</button>
    <button id="m3" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">31</button>
    <button id="m4" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">12</button>
    <button id="m5" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">11</button>
    <button id="m6" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">55</button>
    <button id="m7" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="m8" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">87</button>
    <button id="m9" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">32</button>
    <button id="m10" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">25</button>
    <button id="m11" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">35</button>
    <button id="m12" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">95</button>
    <button id="m13" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">25</button>
    <button id="m14" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">25</button>
    <button id="m15" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">43</button>
    <button id="m16" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">27</button>

    <h3 class="mt-2">选择排序</h3>
    <button id="x1" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">51</button>
    <button id="x2" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">11</button>
    <button id="x3" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">511</button>
    <button id="x4" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">5</button>
    <button id="x5" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="x6" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="x7" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="x8" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="x9" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="x10" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="x11" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="x12" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="x13" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="x14" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="x15" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>
    <button id="x16" disabled="disabled" class="btn btn-secondary" style="height: 38px;width: 60px">15</button>

  </div>

  <div class="container">
    <h1 class="mt-5">2.汉诺塔搬动</h1>
    <input id="num" type="text" class="btn btn-outline-secondary mt-2" placeholder="输入搬动个数">
    <button onclick="creat();" class="btn btn-outline-success mt-2">生成</button>
    <br>
    <button onclick="click_move();" class="btn btn-outline-success mt-2">开始搬动</button>
    <button onclick="restart();" class="btn btn-outline-success mt-2">重新开始</button>

    <div class="row">
      <div id="li1" class="col-4 text-center mt-1"></div>

      <div id="li2" class="col-4 text-center mt-1"></div>

      <div id="li3" class="col-4 text-center mt-1"></div>
    </div>
  </div>

  <div class="container">
    <h1 class="mt-5">3.堆栈的操作</h1>
    <button onclick="in_stack();" class="btn btn-outline-success mt-2">入栈</button>
    <button onclick="out_stack();" class="btn btn-outline-success mt-2">出栈</button>
    <div class="row mt-5">
      <div class="col-4 text-center mt-2">
        <button id="out1" disabled="disabled" class="px-0 mx-0 btn btn-success" style="height: 38px;width: 60px">1</button>
        <button id="out2" disabled="disabled" class="px-0 mx-0 btn btn-info" style="height: 38px;width: 60px">2</button>
        <button id="out3" disabled="disabled" class="px-0 mx-0 btn btn-warning" style="height: 38px;width: 60px">3</button>
        <button id="out4" disabled="disabled" class="px-0 mx-0 btn btn-primary" style="height: 38px;width: 60px">4</button>
        <button id="out5" disabled="disabled" class="px-0 mx-0 btn btn-danger" style="height: 38px;width: 60px">5</button>
      </div>

      <div class="col-auto">
        <h5>栈顶</h5>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <h5>栈底</h5>
      </div>

      <div class="col-auto text-center mx-0 px-0">
        <div class="mx-0" style="width: 10px; height: 208px; background: darkgray;"></div>
      </div>
      <div class="col-auto text-center mx-0 px-0">
        <div class="mt-2">
          <button id="in5" disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
          <br>
          <button id="in4" disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
          <br>
          <button id="in3" disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
          <br>
          <button id="in2" disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
          <br>
          <button id="in1" disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
          <div class="m-0 p-0" style="width: 60px; height: 10px; background: darkgray;"></div>
        </div>
      </div>
      <div class="col-auto text-center mx-0 px-0">
        <div class="mx-0" style="width: 10px; height: 208px; background: darkgray;"></div>
      </div>
    </div>
  </div>

  <div class="container">
    <h1 class="mt-5">4.链表的节点操作</h1>
    <button onclick="insert_l();" class="btn btn-outline-success mt-2">插入</button>
    <button onclick="delete_l();" class="btn btn-outline-success mt-2">删除</button>

    <div class="mt-4">
      <div>
        <img src="{% static 'img/1.png' %}" style="height: 38px; width: 60px">
        <button disabled="disabled" class="px-0 mx-0 btn btn-success" style="height: 38px;width: 60px">1</button>
        <img  src="{% static 'img/1.png' %}" style="height: 38px; width: 60px">
        <button id="lian_inser" disabled="disabled" class="px-0 mx-0 btn btn-success" style="height: 38px;width: 60px">1</button>
        <img id="lian_img0" src="{% static 'img/1.png' %}" style="height: 38px; width: 60px">
        <button disabled="disabled" class="px-0 mx-0 btn btn-success" style="height: 38px;width: 60px">1</button>
      </div>


      <div id="lian_add" style="display: none">
        <button disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
        <button disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
        <button disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
        <img class="ml-4" src="{% static 'img/left.png' %}">
        <button disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
        <img src="{% static 'img/right.png' %}">

        <br>

        <button disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
        <button disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
        <button disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
        <button disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
        <button id="lian_add1" disabled="disabled" class="px-0 mx-0 btn btn-danger" style="height: 38px;width: 60px">1</button>
        <button disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
      </div>
    </div>

  </div>

  <div class="container">
    <h1 class="mt-5">5.队列的操作</h1>
    <button onclick="in_dui();" class="btn btn-outline-success mt-2">入队</button>
    <button onclick="out_dui();" class="btn btn-outline-success mt-2">出队</button>
    <div class="row mt-5">
      <div class="col-4 text-center mt-2">
        <button id="dout1" disabled="disabled" class="px-0 mx-0 btn btn-success" style="height: 38px;width: 60px">1</button>
        <button id="dout2" disabled="disabled" class="px-0 mx-0 btn btn-info" style="height: 38px;width: 60px">2</button>
        <button id="dout3" disabled="disabled" class="px-0 mx-0 btn btn-warning" style="height: 38px;width: 60px">3</button>
        <button id="dout4" disabled="disabled" class="px-0 mx-0 btn btn-primary" style="height: 38px;width: 60px">4</button>
        <button id="dout5" disabled="disabled" class="px-0 mx-0 btn btn-danger" style="height: 38px;width: 60px">5</button>
      </div>

      <div class="col-auto">
        <h5>队顶</h5>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <h5>队底</h5>
      </div>

      <div class="col-auto text-center mx-0 px-0">
        <div class="mx-0" style="width: 10px; height: 208px; background: darkgray;"></div>
      </div>
      <div class="col-auto text-center mx-0 px-0">
        <div class="mt-2">
          <button id="din1" disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
          <br>
          <button id="din2" disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
          <br>
          <button id="din3" disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
          <br>
          <button id="din4" disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>
          <br>
          <button id="din5" disabled="disabled" class="px-0 mx-0 btn btn-light" style="height: 38px;width: 60px"></button>

        </div>
      </div>
      <div class="col-auto text-center mx-0 px-0">
        <div class="mx-0" style="width: 10px; height: 208px; background: darkgray;"></div>
      </div>
    </div>
  </div>




  <div class="container">
    <a href="/yq/"  class="mt-5" style="font-size: 2.5rem; text-decoration: none;">6.疫情地图</a>
  </div>
</body>

<script>

  var lian_num = 0;

  // 链表插入事件
  async function insert_l() {

      $('#lian_add').attr("style", '');
      await wait(50);
      if(lian_num > 0 && lian_num < 6){
          var lian_name = '#lian_img' + lian_num
          $(lian_name).attr("style", "visibility:hidden;");
      } else {
          $('#lian_img0').attr("style", "visibility:hidden;");
      }

      await wait(1200);
      $('#lian_add').attr("style", 'display: none;');

      if(lian_num > 0){
          $(lian_name).attr("style", "");
      } else {
          $('#lian_img0').attr("style", "");
      }

      $('#lian_i').attr("style", "");

      var img = $('<img>', {
              id: "lian_img" + (lian_num + 1),
              src: "{% static 'img/1.png' %}",
              style: "height: 38px; width: 60px",
          });

      var button = $('<button>', {
              id: "lian_button" + (lian_num + 1),
              text: (lian_num + 1),
              disabled: "disabled",
              class: "px-0 mx-0 btn btn-danger",
              style: "height: 38px;width: 60px"
          });

      button.insertAfter($('#lian_inser'))
      img.insertAfter($('#lian_inser'))

      lian_num += 1;

      $('#lian_add1').text(lian_num + 1)

  }



  // 链表删除事件
  async function delete_l(){
      if (lian_num > 0){
          var k1 = "#lian_img" + lian_num;
          $(k1).remove();
          var k2 = "#lian_button" + lian_num
          $(k2).remove();
          var k3 = "#lian_img" + (lian_num - 1)
          $(k3).attr("style", "visibility:hidden;");
          await wait(1000);
          $(k3).attr("style", '');

          lian_num -= 1;
      }
  }

  //栈位置标记
  var zhan_num = 0;

  //队列位置标记
  var dui_num = 0;

  // 入栈点击事件
  async function in_stack(){
      if (zhan_num < 5){
          //console.log("out"+ (zhan_num + 1) + " || " +"in" + (zhan_num + 1))
          await change("out"+ (zhan_num + 1), "in" + (zhan_num + 1), true);
          zhan_num += 1;
      }
  }

  // 出栈点击事件
  async function out_stack(){
      if (zhan_num > 0){
          console.log(zhan_num)
          await change("out"+ zhan_num, "in" + zhan_num, true);
          zhan_num -= 1;
      }
  }

  // 入队点击事件
  async function in_dui(){
      if (dui_num < 5){
          for (var k = dui_num; k > 0; k--){
              console.log(k)
              await change("din"+ k, "din" + (k + 1), true);
              await wait(700);
          }

          await change("dout"+ (dui_num + 1), "din" + 1, true);
          await wait(500);
          dui_num += 1;
      }
  }

  // 出队点击事件
  async function out_dui(){
      if (dui_num > 0){
          await change("dout"+ dui_num, "din" + dui_num, true);
          dui_num -= 1;
      }
  }



  // 网页加载完毕
  $(document).ready(function(){
      get();
  });

  // 绑定汉诺塔点击事件
  function click_move() {
      if(zhu_num > 0){
          move(1, zhu_num, 1, 3, 2)
      }
      else {
          alert('请先生成');
      }
  }


  var zhu = [0,0,0];  // 辅助变量 下表0,1,2表示1,2,3柱子上剩余位置
  var zhu_num = 0;  // 总数

  // 汉诺塔递归函数
  // down 最下边柱子编号
  // top  最上边柱子编号
  // from_z  从柱子
  // to_z    到达柱子
  // use_z   辅助柱子
  async function move(down, top, from_z, to_z, use_z){
      return new Promise(async function (resolve,reject) {
          console.log("move  " + "down: "+ down  + "|| top:"+ top  + "|| from:"+ from_z  + "|| to:"+ to_z  + "|| use:"+ use_z)

          if(top - down > 0){
              var start = zhu_num-zhu[use_z-1] + 1;  // 记录搬去辅助柱子之前，辅助柱子已近占了的位置
              // 1.上面的柱子移动到辅助位置
              await move(down + 1, top, from_z, use_z, to_z);
              // 2.最下面的柱子移动到目标位子
              await move(down, down, from_z, to_z, use_z);
              // 3.上面的柱子移动到目标位置
              await move(start, start + (top - down) - 1, use_z, to_z, from_z);
          } else {
              await change(from_z + '_' + down, to_z + '_' + (zhu_num - zhu[to_z-1] + 1), true);
              await wait(800);
              zhu[from_z - 1] += 1;
              zhu[to_z - 1] -= 1;
          }
          resolve();
      });

  }

  // 根据输入构造汉诺塔图
  function creat() {
      var num = parseInt($("#num").val());
      zhu_num = num;
      zhu[0] = 0;
      zhu[1] = num;
      zhu[2] = num;
      var li1 = $("#li1");
      var li2 = $("#li2");
      var li3 = $("#li3");
      li1.html('');
      li2.html('');
      li3.html('');
      for (var i=1; i<=num; i++){
          var btn1 = $('<button>', {
              id: 1+'_'+i,
              text: i,
              disabled: "disabled",
              class: "btn btn-secondary",
              style: "height: 38px;width: "+ 180.0/(i**0.5) +"px"
          });

          var btn2 = $('<button>', {
              id: 2+'_'+i,
              text: "",
              disabled: "disabled",
              class: "btn btn-light",
              style: "height: 38px;width: 60px"
          });

          var btn3 = $('<button>', {
              id: 3+'_'+i,
              text: "",
              disabled: "disabled",
              class: "btn btn-light",
              style: "height: 38px;width: 60px"
          });

          li1.prepend(btn1);
          li1.prepend($('<br>'));
          li2.prepend(btn2);
          li2.prepend($('<br>'));
          li3.prepend(btn3);
          li3.prepend($('<br>'))
      }
  }

  // 刷新网页
  function restart() {
      window.location.reload();
  }

  // 填入随机值
  function get() {

      for(var i=1;i <= 16;i++){
          var num = Math.floor(Math.random()*100);
          var m = $("#m" + i);
          var x = $("#x" + i);
          m.text(num);
          x.text(num);
          m.attr("class", "btn btn-secondary");
          x.attr("class", "btn btn-secondary");
      }

  }

  // 延迟函数
  function wait(time) {
      return new Promise(function(resolve,reject) {
          setTimeout(resolve,time);
      });
  }

  // 交换模块函数 同步进程封装
  function change(left_id, right_id, kkk) {
      return new Promise(function(resolve,reject) {
          var left = $("#" + left_id);
          var right = $("#" + right_id);
          var left_last_attr = left.attr('class');
          var right_last_attr = right.attr('class');
          left.attr("class", "btn btn-success");
          right.attr("class", "btn btn-success");
          left.swap(right);
          left.attr("id", right_id);
          right.attr("id", left_id);
          if(kkk){
              left.attr("class", left_last_attr);
              right.attr("class", right_last_attr);
          } else {
              left.attr("class", "btn btn-secondary");
              right.attr("class", "btn btn-secondary");
          }

          resolve();
      });
  }

  async function maopao() {
      var idx1 = 0;

      while (idx1 <= 15) {
          await maopao_fuzhu(1, 16 - idx1);
          await wait(200);
          idx1 += 1;
          console.log(idx1)
      }
  }

  async function xuanze() {
      var idx2 = 0;

      while (idx2 <= 15) {
          await xuanze_fuzhu(1, 16 - idx2);
          await wait(300);
          idx2 += 1;
          console.log(idx2)
      }
  }


  function zong() {
      maopao();
      xuanze();
  }

  async function maopao_fuzhu(start_id, end_id) {

      return new Promise(async function(resolve,reject) {
          var now_id = start_id;

          while (now_id < end_id) {
              var now_element = $("#m" + now_id);
              var next_element = $("#m" + (now_id + 1));
              await now_element.attr('class', 'btn btn-success');
              await next_element.attr('class', 'btn btn-success');
              await wait(300);

              if (parseInt(now_element.text()) > parseInt(next_element.text())) {

                  await change('m' + now_id, 'm' + (now_id + 1), false);
                  await wait(400);
                  now_element.attr('class', 'btn btn-secondary');
                  now_id += 1;

              } else {
                  now_element.attr('class', 'btn btn-secondary');
                  now_id += 1;

                  await $("#m" + now_id).attr('class', 'btn btn-warning');
                  await wait(400);
              }  //end else
          }  // end while

          await $("#m" + end_id).attr('class', 'btn btn-danger');
          await wait(100);
          resolve();
      });
  }

  async function xuanze_fuzhu(start_id, end_id){

      return new Promise(async function(resolve,reject) {
          var now_id = start_id + 1;
          var max_id = start_id;
          while (now_id <= end_id && end_id > 1) {
              var now_element = $("#x" + now_id);
              var max_element = $("#x" + max_id);

              await max_element.attr('class', 'btn btn-danger');
              await now_element.attr('class', 'btn btn-success');
              await wait(300);

              if (parseInt(now_element.text()) > parseInt(max_element.text())) {

                  max_id = now_id;
                  max_element.attr('class', 'btn btn-secondary');
                  now_element.attr('class', 'btn btn-danger');
                  now_id += 1;

              } else {
                  now_element.attr('class', 'btn btn-secondary');
                  now_id += 1;
              }  //end else
          }  // end while

          if(end_id > 1){
              await change('x' + max_id, 'x' + end_id, false);
          }

          await wait(400);
          await $("#x" + end_id).attr('class', 'btn btn-danger');

          resolve();
      });
  }
</script>
</html>